<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>MongoDB</title>
	<link rel="stylesheet" href="./css/bootstrap.css" media="screen">
</head>
<body>
	<div class="container">
	
		<h1><!--<img src="http://www.cumulogic.com/wp-content/uploads/2013/12/mongodb-logo.png" 
					height="70" width="214"/>-->
			<img src="http://nellytodorova.com/wp-content/uploads/2014/12/mongodb.png" 
					height="85" width="190"/>
					 за уеб приложения</h1>
		<div class="col-lg-3 col-md-3 col-sm-4">
			<div class="list-group table-of-contents">
				<a class="list-group-item" href="#id1">Какво е MongoDB?</a>
				<a class="list-group-item" href="#id2">Документи</a>
				<a class="list-group-item" href="#id3">Примерни документи</a>
				<a class="list-group-item" href="#id4">Колекции</a>
				<a class="list-group-item" href="#id5">Forms</a>
			</div>
		</div>
		<article id="id1">
			<hgroup>
				<h2>Какво е MongoDB?</h2>
			</hgroup>
			<p>
			MongoDB е документна база данни с отворен код, която предлага висока производителност, надеждност и автоматично скалиране. MongoDB премахва нуждата от ORM, като така улеснява работата по проектите.
			</p>
		</article>
		<article id="id2">
			<hgroup>
				<h2>Документи</h2>
			</hgroup>
			<p>
			Записите в MongoDB се наричат документи. Това е структура от данни, която се състои от двойки (поле, стойност). Тези документи са много подобни на JSON обектите. Стойностите на полетата могат да включват и други документи, масиви, масиви от документи.
			Документите трябва да имат уникално поле <strong>_id</strong>, което е първичен ключ. MongoDB пази документите на диска в BSON формат, което е двоично представяне на JSON документ, въпреки че може да съдържа повече типове данни от JSON.
			За Mongo има JavaScript shell, както и драйвери за различните езици, които са медиатор между BSON и специфичното за езика представяне на документа.
			</p>
			<hgroup>
				<h3>Ограничения на документите</h3>
			</hgroup>
			<p>
				Максималният размер на BSON документ е 16 мегабайта. Това спомага за пестенето на рам паметта. За да се запазват документи над максималният размер, MongoDB предлага GridFS API.
			</p>
			<hgroup>
				<h3>_id поле</h3>
			</hgroup>
			<p>
				<ul>
					<li>
						По подразбиране, MongoDB създава уникален индекс по полето <strong>_id</strong> по време на създаване на колекцията.
					</li>
					<li>
						Това поле винаги е първо в документа. Ако сървърът получи документ, чието _id не е първо, то той ще го премести на водеща позиция.
					</li>
					<li>
						_id може да бъде всякаква стойност от BSON тип, с изключение на масив.
					</li>
					<li>
						Обикновено за _id се използва ObjectId тип. Друг вариант е да се използва естествен първичен ключ, който разбира се трябва да е уникален. Това спестява място и нужда от още един индекс. Друг вариант е да се използва поредица от естествени числа, като се увеличават автоматично. Също така може да се използва и GUID, генериран от нашето приложение. 
					</li>
				</ul>
			</p>
			<p>
				<pre>
{
	_id: ObjectId("5099803df3f4948bd2f98391"),
	name: { first: "Alan", last: "Turing" },
	birth: new Date('Jun 23, 1912'),
	death: new Date('Jun 07, 1954'),
	contribs: [ "Turing machine", "Turing test", "Turingery" ],
	views : NumberLong(1250000)
 }
				</pre>
				Полетата от горният пример имат следните типове:
				<ul>
					<li>_id е от тип ObjectId.</li>
					<li>name съдържа вграден документ, който е с 2 полета-първо и последно име</li>
					<li>birth и death са от тип Date.</li>
					<li>contribs е масив от стрингове.</li>
					<li>views е число от тип NumberLong.</li>
				</ul>
			</p>
		</article>
		<article id="id4">
			<hgroup>
				<h2>Колекции</h2>
			</hgroup>
			<p>
			MongoDB пази документите в колекции. Колекциите са аналогични на таблиците в релационните бази данни. За разлика от тях, обаче, колекцията не изисква предварително зададена схема. Също така няма значение дали документите в нея са с една и съща схема.
			</p>
		</article>
		<article id="id5">
			<hgroup>
				<h2>Java driver</h2>
			</hgroup>
			<p>
				<hgroup>
					<h3>Установяване на връзка с базата</h3>
				</hgroup>
				<p>
				За да се установи връзка с базата, трябва като минимум да имаме името ѝ. Няма нужда тя да съществува, MongoDB може да я създаде за нас. Допълнително може да се зададе адрес и порт на който да се свържем. Ако не бъдат зададени се използват дефолтните. Следният пример показва как да се свържем към база <strong>mydb</strong> локално:
				<pre>
import com.mongodb.BasicDBObject;
import com.mongodb.BulkWriteOperation;
import com.mongodb.BulkWriteResult;
import com.mongodb.Cursor;
import com.mongodb.DB;
import com.mongodb.DBCollection;
import com.mongodb.DBCursor;
import com.mongodb.DBObject;
import com.mongodb.MongoClient;
import com.mongodb.ParallelScanOptions;
import com.mongodb.ServerAddress;

import java.util.List;
import java.util.Set;

import static java.util.concurrent.TimeUnit.SECONDS;

// To directly connect to a single MongoDB server (note that this will not auto-discover the primary even
// if it's a member of a replica set:
MongoClient mongoClient = new MongoClient();
// or
MongoClient mongoClient = new MongoClient( "localhost" );
// or
MongoClient mongoClient = new MongoClient( "localhost" , 27017 );
// or, to connect to a replica set, with auto-discovery of the primary, supply a seed list of members
MongoClient mongoClient = new MongoClient(Arrays.asList(new ServerAddress("localhost", 27017),
                                      new ServerAddress("localhost", 27018),
                                      new ServerAddress("localhost", 27019)));

DB db = mongoClient.getDB( "mydb" );
				</pre>
				В този момент, обектът db ще бъде нашата връзка с MongoDB сървър за дадената база. С него можем да правим някои интересни операции.
				Mongoclient класът е създаден да бъде безопасен в конкурентна среда с повече нишки, които да го споделят. По принцип се създава само 1 инстанция за дадена база и се използва из цялото приложение. </br>
				<hgroup>
					<h3>Автентикация</h3>
				</hgroup>
				Можем да използваме и автентикация по следният начин.
				<pre>
MongoCredential credential = MongoCredential.createCredential(userName, database, password);
MongoClient mongoClient = new MongoClient(new ServerAddress(), Arrays.asList(credential));
				</pre>
				<hgroup>
					<h3>Взимане на колекция</h3>
				</hgroup>
				Можем да вземем дадена колекция по следният начин:
				<pre>
DBCollection coll = db.getCollection("testCollection");
				</pre>
				След като веднъж сме получили обектът за колекция, може да добавяме данни или да правим заявки.
				<hgroup>
					<h3>Задаване на политика за записване</h3>
				</hgroup>
				По подразбиране тя е WriteConcern.ACKNOWLEDGED, но можем да я сменим с журнална (както в примера), както и още много други
				<pre>
mongoClient.setWriteConcern(WriteConcern.JOURNALED);
				</pre>
				<hgroup>
					<h3>Добавяне на документ</h3>
				</hgroup>
				След като вече имаме обектът за колекция, може да добавим документи в нея. Например ако имаме малък документ изглеждащ така в JSON формат:
				<pre>
{
   "name" : "MongoDB",
   "type" : "database",
   "count" : 1,
   "info" : {
               x : 203,
               y : 102
             }
}
				</pre>
				В случаят има вграден документ в него. За да го имплементираме, може да използваме BasicDBObject за да създадем документа, както и вътрешният такъв. След това го добавяме с операцията <strong>insert()</strong> 
				<pre>
BasicDBObject doc = new BasicDBObject("name", "MongoDB")
        .append("type", "database")
        .append("count", 1)
        .append("info", new BasicDBObject("x", 203).append("y", 102));
coll.insert(doc);
				</pre>
				<hgroup>
					<h3>Намиране на документ в колекция с findOne()</h3>
				</hgroup>
				За да покажем че документът, който добавихме на предишната стъпка е там, може да използваме просто <strong>findOne()</strong> за да вземем първият документ от колекцията. Този метод връща само един документ, за разлика от курсорът който връща <strong>find()</strong>. 

				<pre>
DBObject myDoc = coll.findOne();
System.out.println(myDoc);
				</pre>
				получаваме
				<pre>
{ "_id" : "49902cde5162504500b45c2c" ,
  "name" : "MongoDB" ,
  "type" : "database" ,
  "count" : 1 ,
  "info" : { "x" : 203 , "y" : 102}}
				</pre>
				<hgroup>
					<h3>Добавяне на повече документи</h3>
				</hgroup>
				</p>
			</p>
		</article>


		<article id="usedDocuments">
			<hgroup>
				<h2>Източници</h2>
			</hgroup>
			<p>
				https://docs.mongodb.org/getting-started/java/introduction/
				https://docs.mongodb.org/getting-started/java/client/
			</p>
		</article>
	</div>
	<script src="./js/jquery-1.10.2.min.js"></script>
	<script src="./js/bootstrap.min.js"></script>
</body>
</html>